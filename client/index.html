<html>
<head>
  <script>
    var ws = null;
    function connect()
    {
      if(ws !== null)
        return log('已连接');
      ws = new WebSocket('ws://localhost:3000/s');
      ws.onopen = function()
      {
        log('连接成功');
      };
      ws.onerror = function(error)
      {
        log(error);
      };
      ws.onmessage = function(e)
      {
        log('收到: ' + e.data);
      };
      ws.onclose = function()
      {
        log('断开连接');
        ws = null;
      };
      return false;
    }
    function disconnect()
    {
      if(ws === null)
        return log('已断开');
      ws.close();
      return false;
    }
    function send()
    {
      if(ws === null)
        return log('先点击连接');
      var text = document.getElementById('text').value;
      document.getElementById('text').value = "";
      log('发送: ' + text);
      ws.send(text);
      return false;
    }
    function log(text)
    {
      var li = document.createElement('li');
      li.appendChild(document.createTextNode(text));
      document.getElementById('log').appendChild(li);
      return false;
    }
  </script>
</head>
<body>
<form onsubmit="return send();">
  <button type="button" onclick="return connect();">
    连接
  </button>
  <button type="button" onclick="return disconnect();">
    断开
  </button>
  <input id="text" type="text">
  <button type="submit">发送</button>
</form>
<ol id="log"></ol>
</body>
</html>
